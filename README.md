
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER (Browser)                                 â”‚
â”‚  â€¢ Visits landing page                                                  â”‚
â”‚  â€¢ Enters topic: "How does photosynthesis work?"                        â”‚
â”‚  â€¢ Clicks "Generate Video"                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ POST /createvideo
                                 â”‚ { input: "topic", id: 1735481234567 }
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REACT FRONTEND (Port 5173)                         â”‚
â”‚  â€¢ Generates unique userId (timestamp)                                  â”‚
â”‚  â€¢ Sends HTTP POST request                                              â”‚
â”‚  â€¢ Shows loading state                                                  â”‚
â”‚  â€¢ Starts polling every 3 seconds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
                                 â”‚                                        â”‚
                                 â”‚ HTTP Requests                          â”‚
                                 â”‚                                        â”‚
                                 â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     EXPRESS SERVER (Port 3000)                          â”‚
â”‚                                                                         â”‚
â”‚  Endpoints:                                                             â”‚
â”‚  â€¢ POST /createvideo    â”€â”€â”€ Creates job                                 â”‚
â”‚  â€¢ GET /status/:userId  â”€â”€â”€ Returns job status â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                  â”‚
                       â”‚                  â”‚
          Stores job   â”‚                  â”‚  Adds job to queue
          status       â”‚                  â”‚  { userId, userInput }
                       â”‚                  â”‚
                       â–¼                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  UPSTASH REDIS  â”‚   â”‚     BULLMQ       â”‚
         â”‚   (Database)    â”‚   â”‚   (Job Queue)    â”‚
         â”‚                 â”‚   â”‚                  â”‚
         â”‚  Stores:        â”‚   â”‚  â€¢ Manages jobs  â”‚
         â”‚  â€¢ Job status   â”‚   â”‚  â€¢ Job priority  â”‚
         â”‚  â€¢ Progress     â”‚   â”‚  â€¢ Retry logic   â”‚
         â”‚  â€¢ Video URL    â”‚   â”‚  â€¢ Concurrency   â”‚
         â”‚                 â”‚   â”‚                  â”‚
         â”‚  Key: userId    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚  Value: {...}   â”‚            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ Worker picks job
                                        â”‚ when available
                                        â”‚
                                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           WORKER PROCESS                     â”‚
         â”‚        (Background Job Processor)            â”‚
         â”‚                                              â”‚
         â”‚  1. Picks job from BullMQ queue              â”‚
         â”‚  2. Extends lock (30 min timeout)            â”‚
         â”‚  3. Creates user folders                     â”‚
         â”‚  4. Updates Redis: "Processing..."           â”‚
         â”‚  5. Executes 6-step pipeline â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                                        â”‚
                                                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ PIPELINE EXECUTION:
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: AI SCRIPT GENERATION                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker â†’ Gemini AI                                                 â”‚
â”‚                                                                     â”‚
â”‚  Input:  "How does photosynthesis work?"                            â”‚
â”‚  Output: {                                                          â”‚
â”‚    "script": [                                                      â”‚
â”‚      "Photosynthesis is how plants make food.",                     â”‚
â”‚      "Sunlight is absorbed by chlorophyll.",                        â”‚
â”‚      "This converts CO2 and water into glucose."                    â”‚
â”‚    ],                                                               â”‚
â”‚    "visuals": [                                                     â”‚
â”‚      "Show green plant with sun rays",                              â”‚
â”‚      "Animate light entering leaves",                               â”‚
â”‚      "Display chemical equation"                                    â”‚
â”‚    ]                                                                â”‚
â”‚  }                                                                  â”‚
â”‚                                                                     â”‚
â”‚  Updates Redis: "Generating script... âœ“"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: AUDIO GENERATION                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker â†’ Google TTS API                                            â”‚
â”‚                                                                     â”‚
â”‚  For each script line:                                              â”‚
â”‚    1. Call Google Text-to-Speech                                    â”‚
â”‚    2. Download MP3: "line_1.mp3"                                    â”‚
â”‚    3. Measure duration with FFprobe: 3.2s                           â”‚
â”‚                                                                     â”‚
â”‚  Output:                                                            â”‚
â”‚    â€¢ line_1.mp3 (3.2s)                                              â”‚
â”‚    â€¢ line_2.mp3 (2.8s)                                              â”‚
â”‚    â€¢ line_3.mp3 (4.1s)                                              â”‚
â”‚                                                                     â”‚
â”‚  audioDurations = [                                                 â”‚
â”‚    {line: "...", duration: 3.2, visuals: "..."},                    â”‚
â”‚    {line: "...", duration: 2.8, visuals: "..."},                    â”‚
â”‚    {line: "...", duration: 4.1, visuals: "..."}                     â”‚
â”‚  ]                                                                  â”‚
â”‚                                                                     â”‚
â”‚  Updates Redis: "Generating audio... âœ“"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: MANIM CODE GENERATION (WITH AUTO-RETRY)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker â†’ Gemini AI (Attempt 1)                                     â”‚
â”‚                                                                     â”‚
â”‚  Input:                                                             â”‚
â”‚    â€¢ Script + Visuals + Timings                                     â”‚
â”‚    â€¢ Manim coding rules                                             â”‚
â”‚    â€¢ Timing constraints                                             â”‚
â”‚                                                                     â”‚
â”‚  AI generates:                                                      â”‚
â”‚    from manim import *                                              â”‚
â”‚                                                                     â”‚
â”‚    class Scene_1(Scene):                                            â”‚
â”‚        def construct(self):                                         â”‚
â”‚            plant = Circle(color=GREEN)                              â”‚
â”‚            sun = Circle(color=YELLOW)                               â”‚
â”‚            self.play(Create(plant))                                 â”‚
â”‚            self.wait(2.2)  # Total = 3.2s                           â”‚
â”‚                                                                     â”‚
â”‚  Save to: animation.py                                              â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ TEST RENDER: manim -pqh animation.py   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                    â”‚                                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚         â”‚                     â”‚                                     â”‚
â”‚    âœ… SUCCESS            âŒ ERROR                                   â”‚
â”‚    Continue               "undefined color BROWN"                   â”‚
â”‚                           â”‚                                         â”‚
â”‚                           â”œâ”€â–º Log error                             â”‚
â”‚                           â”œâ”€â–º Worker â†’ Gemini AI (Attempt 2)        â”‚
â”‚                           â”‚   "Fix this error: ..."                 â”‚
â”‚                           â”‚   AI corrects code                      â”‚
â”‚                           â”œâ”€â–º TEST RENDER again                     â”‚
â”‚                           â”‚                                         â”‚
â”‚                           â””â”€â–º Retry up to 4 times                   â”‚
â”‚                                                                     â”‚
â”‚  Updates Redis: "Generating animation code (Attempt X/4)..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: MANIM RENDERING & SCENE MERGING                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Manim CLI renders Python code:                                     â”‚
â”‚                                                                     â”‚
â”‚  Output videos:                                                     â”‚
â”‚    â€¢ Scene_1.mp4 (3.2s) â”€â”                                          â”‚
â”‚    â€¢ Scene_2.mp4 (2.8s) â”€â”¤                                          â”‚
â”‚    â€¢ Scene_3.mp4 (4.1s) â”€â”¤                                          â”‚
â”‚                          â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â”œâ”€â–º Create video_list.txt:                                         â”‚
â”‚  â”‚   file 'Scene_1.mp4'                                             â”‚
â”‚  â”‚   file 'Scene_2.mp4'                                             â”‚
â”‚  â”‚   file 'Scene_3.mp4'                                             â”‚
â”‚  â”‚                                                                  â”‚
â”‚  â””â”€â–º FFmpeg merge:                                                  â”‚
â”‚      ffmpeg -f concat -i video_list.txt -c copy animation.mp4       â”‚
â”‚                                                                     â”‚
â”‚  Result: animation.mp4 (10.1s, no audio)                            â”‚
â”‚                                                                     â”‚
â”‚  Updates Redis: "Rendering animations... âœ“"                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: AUDIO + VIDEO SYNCHRONIZATION                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Part A: Merge Audio Files                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚    line_1.mp3 â”€â”                                                    â”‚
â”‚    line_2.mp3 â”€â”¼â”€â–º FFmpeg concat                                    â”‚
â”‚    line_3.mp3 â”€â”˜   ffmpeg -f concat ... final_audio.mp3             â”‚
â”‚                                                                     â”‚
â”‚    Result: final_audio.mp3 (10.1s)                                  â”‚
â”‚                                                                     â”‚
â”‚  Part B: Merge Audio + Video                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚    animation.mp4 (10.1s) â”€â”                                         â”‚
â”‚    final_audio.mp3 (10.1s)â”€â”¼â”€â–º FFmpeg merge                         â”‚
â”‚                            â”‚   ffmpeg -i video -i audio ...         â”‚
â”‚                            â”‚   -shortest final_video.mp4            â”‚
â”‚                            â”‚                                        â”‚
â”‚                            â””â”€â–º final_video.mp4                      â”‚
â”‚                                                                     â”‚
â”‚  Result: Complete video with synced narration!                      â”‚
â”‚                                                                     â”‚
â”‚  Updates Redis: "Merging audio with video... âœ“"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: CLOUD UPLOAD & COMPLETION                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker â†’ Cloudinary API                                            â”‚
â”‚                                                                     â”‚
â”‚  1. Read: final_video.mp4                                           â”‚
â”‚  2. Upload to Cloudinary                                            â”‚
â”‚  3. Receive URL:                                                    â”‚
â”‚     https://res.cloudinary.com/xxx/video/upload/v123/video.mp4      â”‚
â”‚                                                                     â”‚
â”‚  4. Update Redis with completion:                                   â”‚
â”‚     {                                                               â”‚
â”‚       message: "Video generation completed!",                       â”‚
â”‚       isprocessing: false,                                          â”‚
â”‚       isdone: true,                                                 â”‚
â”‚       iserror: false,                                               â”‚
â”‚       video_uri: "https://cloudinary.com/..."                       â”‚
â”‚     }                                                               â”‚
â”‚                                                                     â”‚
â”‚  5. Cleanup temporary files                                         â”‚
â”‚  6. Keep final video + logs                                         â”‚
â”‚                                                                     â”‚
â”‚  Worker marks job as COMPLETE âœ“                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Status stored in Redis
                                  â”‚
                                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚       UPSTASH REDIS (Updated)        â”‚
         â”‚                                      â”‚
         â”‚  userId: {                           â”‚
         â”‚    message: "Video ready!",          â”‚
         â”‚    isdone: true,                     â”‚
         â”‚    video_uri: "https://..."          â”‚
         â”‚  }                                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Frontend polls
                            â”‚ GET /status/:userId
                            â”‚
                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     EXPRESS SERVER (Port 3000)       â”‚
         â”‚  â€¢ Fetches data from Redis           â”‚
         â”‚  â€¢ Returns JSON response             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Response:
                            â”‚ { isdone: true, video_uri: "..." }
                            â”‚
                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     REACT FRONTEND (Port 5173)       â”‚
         â”‚  â€¢ Receives completion status        â”‚
         â”‚  â€¢ Stops polling                     â”‚
         â”‚  â€¢ Shows success message             â”‚
         â”‚  â€¢ Displays video player             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          USER (Browser)              â”‚
         â”‚   Video Ready!                       â”‚
         â”‚   [Video Player]                     â”‚
         â”‚   Download â€¢ ğŸ”— Share                â”‚
         â”‚                                      â”‚
         â”‚  Total time: 2-5 minutes             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
https://res.cloudinary.com/dxoptpeuq/video/upload/v1761719374/hackathon_videos/tvxlbkoquersbvegyjfk.mp4
```

---

## **KEY COMPONENTS EXPLAINED:**

### **1. USER â†’ FRONTEND**
- User enters topic in browser
- React creates unique ID (timestamp)
- Sends HTTP POST request

### **2. FRONTEND â†’ BACKEND**
- Express server receives request
- Creates job data structure
- Returns immediately (non-blocking)

### **3. BACKEND â†’ REDIS + BULLMQ**
- **Redis**: Stores job status (for polling)
- **BullMQ**: Queues job for processing
- Separation of concerns

### **4. BULLMQ â†’ WORKER**
- Worker picks up job when available
- Processes one job at a time
- Updates Redis throughout process

### **5. WORKER PIPELINE (6 STEPS)**
- **Step 1**: AI generates script
- **Step 2**: TTS creates audio
- **Step 3**: AI writes animation code (with retry)
- **Step 4**: Manim renders videos
- **Step 5**: FFmpeg merges everything
- **Step 6**: Upload to Cloudinary

### **6. WORKER â†’ REDIS â†’ FRONTEND**
- Worker updates Redis with completion
- Frontend polls and receives update
- Displays video to user

---

## **DATA FLOW:**
```
User Input â†’ Queue â†’ Worker â†’ AI â†’ Audio â†’ Code â†’ Render â†’ Merge â†’ Upload â†’ User
     â†“         â†“       â†“                                                    â†‘
  Frontend  Backend  Redis â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Status Updates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                                    (Polling every 3s)
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
